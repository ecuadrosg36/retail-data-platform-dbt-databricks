version: 2

sources:
  - name: raw_retail
    description: "Raw retail data from seeds (Bronze layer)"
    database: "{{ target.database }}"
    schema: bronze
    
    # Data freshness monitoring
    freshness:
      warn_after: {count: 24, period: hour}
      error_after: {count: 48, period: hour}
    
    tables:
      - name: raw_orders
        description: "Raw orders data"
        columns:
          - name: order_id
            description: "Unique order identifier"
            tests:
              - unique
              - not_null
          
          - name: customer_id
            description: "Customer who placed the order"
            tests:
              - not_null
          
          - name: order_date
            description: "Date the order was placed"
            tests:
              - not_null
          
          - name: status
            description: "Order status"
            tests:
              - accepted_values:
                  values: ['pending', 'shipped', 'delivered', 'cancelled', 'returned']
          
          - name: total_amount
            description: "Total order value"
            tests:
              - not_null
              - dbt_expectations.expect_column_values_to_be_between:
                  min_value: 0
                  max_value: 100000
      
      - name: raw_customers
        description: "Raw customer data"
        columns:
          - name: customer_id
            description: "Unique customer identifier"
            tests:
              - unique
              - not_null
          
          - name: customer_name
            description: "Customer full name"
            tests:
              - not_null
          
          - name: email
            description: "Customer email address"
            tests:
              - not_null
              - dbt_expectations.expect_column_values_to_match_regex:
                  regex: "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"
          
          - name: country
            description: "Customer country"
            tests:
              - not_null
      
      - name: raw_products
        description: "Raw product catalog"
        columns:
          - name: product_id
            description: "Unique product identifier"
            tests:
              - unique
              - not_null
          
          - name: product_name
            description: "Product name"
            tests:
              - not_null
          
          - name: category
            description: "Product category"
            tests:
              - accepted_values:
                  values: ['Electronics', 'Clothing', 'Home', 'Books', 'Sports']
          
          - name: price
            description: "Product price"
            tests:
              - not_null
              - dbt_expectations.expect_column_values_to_be_between:
                  min_value: 0
                  max_value: 10000
